---
import Layout from '../../../layouts/Layout.astro';
import Navigation from '../../../components/git-cheatsheet/Navigation.astro';
---

<Layout title="リモート編 - Gitコマンドチートシート">
  <main>
    <header class="page-header">
      <h1>リモート編</h1>
      <p class="subtitle">リモートリポジトリとの連携、共同作業の基本</p>
    </header>

    <Navigation currentPage="remote" />

    <article>
      <section id="remote-basics">
        <h2>1. リモートリポジトリの基本</h2>
        <p>
          リモートリポジトリは、ネットワーク上（GitHub、GitLabなど）やローカルネットワーク上に存在する
          Gitリポジトリです。チーム開発では、リモートリポジトリを介してコードを共有します。
        </p>

        <h3>リモートリポジトリの確認</h3>
        <p>
          現在設定されているリモートリポジトリを確認する方法です。
        </p>
        <div class="command-block">
          <pre><code># リモートリポジトリの一覧表示
git remote

# リモートリポジトリの詳細情報（URL含む）
git remote -v
git remote --verbose

# 特定のリモートの詳細情報
git remote show origin

# すべてのリモートの詳細情報
git remote show</code></pre>
        </div>

        <h3>リモートリポジトリの追加</h3>
        <p>
          新しいリモートリポジトリを追加する方法です。
        </p>
        <div class="command-block">
          <pre><code># リモートリポジトリを追加
git remote add origin https://github.com/username/repository.git

# 複数のリモートを追加（フォーク元など）
git remote add upstream https://github.com/original/repository.git

# SSHでリモートを追加（推奨）
git remote add origin git@github.com:username/repository.git

# ローカルパスをリモートとして追加
git remote add local /path/to/repository</code></pre>
        </div>

        <h3>リモートリポジトリの変更</h3>
        <p>
          既存のリモートリポジトリの設定を変更する方法です。
        </p>
        <div class="command-block">
          <pre><code># リモートのURLを変更
git remote set-url origin https://github.com/username/new-repository.git

# HTTPSからSSHに変更
git remote set-url origin git@github.com:username/repository.git

# リモートの名前を変更
git remote rename origin upstream

# リモートを削除
git remote remove origin
git remote rm origin</code></pre>
        </div>

        <h3>リモートブランチの確認</h3>
        <p>
          リモートリポジトリのブランチ情報を確認する方法です。
        </p>
        <div class="command-block">
          <pre><code># リモートブランチの一覧
git branch -r

# すべてのブランチ（ローカル+リモート）
git branch -a

# リモートブランチの詳細情報
git remote show origin

# 削除されたリモートブランチの参照を削除
git remote prune origin
git fetch --prune</code></pre>
        </div>
      </section>

      <section id="fetch-pull">
        <h2>2. FetchとPull</h2>
        <p>
          リモートリポジトリから変更を取得する2つの主要なコマンドです。
          それぞれの違いと使い分けを理解することが重要です。
        </p>

        <h3>Fetch（フェッチ）</h3>
        <p>
          リモートの変更を取得しますが、ローカルブランチには自動でマージしません。
          安全に変更内容を確認してからマージできます。
        </p>
        <div class="command-block">
          <h4>基本的な使い方</h4>
          <pre><code># デフォルトリモート（origin）から取得
git fetch

# 特定のリモートから取得
git fetch origin
git fetch upstream

# 特定のブランチのみ取得
git fetch origin main

# すべてのリモートから取得
git fetch --all

# タグも含めて取得
git fetch --tags

# 削除されたリモートブランチの参照も削除
git fetch --prune
git fetch -p</code></pre>

          <h4>Fetch後の確認とマージ</h4>
          <pre><code># リモートの変更を確認
git log HEAD..origin/main
git diff HEAD..origin/main

# 問題なければマージ
git merge origin/main

# または現在のブランチに取り込む
git rebase origin/main</code></pre>
        </div>

        <h3>Pull（プル）</h3>
        <p>
          FetchとMergeを組み合わせたコマンドです。
          リモートの変更を取得して、現在のブランチに自動的にマージします。
        </p>
        <div class="command-block">
          <h4>基本的な使い方</h4>
          <pre><code># 現在のブランチにpull（fetch + merge）
git pull

# 特定のリモート・ブランチからpull
git pull origin main

# Rebaseでpull（fetch + rebase）
git pull --rebase
git pull -r

# Fast-forwardのみ許可
git pull --ff-only

# すべてのサブモジュールも更新
git pull --recurse-submodules</code></pre>

          <h4>Pullの設定</h4>
          <pre><code># デフォルトでRebaseを使用するよう設定
git config --global pull.rebase true

# デフォルトでMergeを使用（デフォルト）
git config --global pull.rebase false

# Fast-forwardのみ許可
git config --global pull.ff only

# 現在のリポジトリのみの設定
git config pull.rebase true</code></pre>
        </div>

        <h3>FetchとPullの違い</h3>
        <p>
          2つのコマンドの違いを理解して、状況に応じて使い分けましょう。
        </p>
        <div class="command-block">
          <pre><code># Fetch: 安全に確認してからマージ
git fetch origin
git log HEAD..origin/main  # 変更内容を確認
git merge origin/main      # 問題なければマージ

# Pull: 取得と同時にマージ（便利だが注意が必要）
git pull origin main
# = git fetch origin + git merge origin/main

# Fetchが推奨される場面
# - 変更内容を確認してからマージしたい
# - 複数のリモートから取得する
# - マージ方法を選択したい

# Pullが適切な場面
# - 日常的な更新作業
# - 信頼できるリモートからの取得
# - 素早く最新を取り込みたい</code></pre>
        </div>

        <h3>Pullのコンフリクト解決</h3>
        <p>
          Pull時にコンフリクトが発生した場合の対処法です。
        </p>
        <div class="command-block">
          <pre><code># Pullでコンフリクトが発生
git pull origin main
# CONFLICT...

# 1. コンフリクトを解決
# エディタで修正

# 2. 解決したファイルをステージング
git add conflicted-file.txt

# 3. マージをコミット
git commit

# Pullを中断して元に戻す
git merge --abort

# Rebase中のコンフリクト
git pull --rebase
# CONFLICT...
git add conflicted-file.txt
git rebase --continue
# または
git rebase --abort</code></pre>
        </div>
      </section>

      <section id="push">
        <h2>3. Push（プッシュ）</h2>
        <p>
          ローカルの変更をリモートリポジトリに送信します。
          チームメンバーと作業を共有するための重要なコマンドです。
        </p>

        <h3>基本的なPush</h3>
        <p>
          ローカルブランチの変更をリモートに送信する方法です。
        </p>
        <div class="command-block">
          <pre><code># 現在のブランチをpush
git push

# 特定のリモート・ブランチにpush
git push origin main

# 初回push時に上流ブランチを設定
git push -u origin feature-login
git push --set-upstream origin feature-login

# 設定後は git push のみで可能
git push</code></pre>
        </div>

        <h3>上流ブランチの設定</h3>
        <p>
          ローカルブランチとリモートブランチの関連付けを設定します。
        </p>
        <div class="command-block">
          <pre><code># 現在のブランチの上流を設定
git branch --set-upstream-to=origin/main
git branch -u origin/main

# Push時に自動設定（Git 2.37以降）
git config --global push.autoSetupRemote true
git push  # 自動的に上流が設定される

# 上流ブランチの確認
git branch -vv</code></pre>
        </div>

        <h3>すべてのブランチをPush</h3>
        <p>
          複数のブランチを一度にプッシュする方法です。
        </p>
        <div class="command-block">
          <pre><code># すべてのブランチをpush
git push --all origin

# すべてのタグをpush
git push --tags origin

# ブランチとタグをすべてpush
git push --all origin
git push --tags origin
# または
git push --follow-tags origin</code></pre>
        </div>

        <h3>強制Push</h3>
        <p>
          リモートの履歴を上書きする危険な操作です。使用には十分注意してください。
        </p>
        <div class="command-block">
          <h4>通常の強制Push</h4>
          <pre><code># 強制push（危険！）
git push --force origin main
git push -f origin main

# ⚠️ 警告
# - 他の人の変更を消す可能性がある
# - チーム開発では避けるべき
# - 個人ブランチでのみ使用を検討</code></pre>

          <h4>安全な強制Push</h4>
          <pre><code># リモートが期待する状態の場合のみpush（推奨）
git push --force-with-lease origin main

# 仕組み
# - ローカルが最後に取得した状態とリモートの現在の状態を比較
# - 一致する場合のみpushを実行
# - 不一致の場合は拒否（誰かが変更を加えた）

# 使用例
git fetch origin
git rebase -i HEAD~3  # コミット履歴を整理
git push --force-with-lease origin feature-branch</code></pre>
        </div>

        <h3>Pushの削除操作</h3>
        <p>
          リモートブランチやタグを削除する方法です。
        </p>
        <div class="command-block">
          <pre><code># リモートブランチを削除
git push origin --delete feature-branch
git push origin :feature-branch  # 古い書き方

# リモートタグを削除
git push origin --delete v1.0.0
git push origin :refs/tags/v1.0.0

# 複数のブランチを削除
git push origin --delete branch1 branch2 branch3</code></pre>
        </div>

        <h3>Pushのトラブルシューティング</h3>
        <p>
          Push時によくあるエラーと解決方法です。
        </p>
        <div class="command-block">
          <h4>「non-fast-forward」エラー</h4>
          <pre><code># エラー: Updates were rejected because the tip of your current branch is behind

# 原因: リモートに新しいコミットがある

# 解決方法1: Pullしてからpush
git pull origin main
git push origin main

# 解決方法2: Rebaseしてからpush
git pull --rebase origin main
git push origin main

# 解決方法3: 強制push（注意！）
git push --force-with-lease origin main</code></pre>

          <h4>認証エラー</h4>
          <pre><code># HTTPSでの認証エラー
# - Personal Access Tokenを使用
# - Credential Helperを設定

# SSHでの認証エラー
# - SSH鍵が正しく設定されているか確認
ssh -T git@github.com

# - SSH鍵を追加
ssh-add ~/.ssh/id_rsa</code></pre>

          <h4>容量制限エラー</h4>
          <pre><code># 大きなファイルのpushエラー

# Git LFS（Large File Storage）を使用
git lfs install
git lfs track "*.psd"
git add .gitattributes
git add large-file.psd
git commit -m "Add large file"
git push</code></pre>
        </div>
      </section>

      <section id="collaboration">
        <h2>4. 共同作業のワークフロー</h2>
        <p>
          チームでGitを使用する際の一般的なワークフローとベストプラクティスです。
        </p>

        <h3>基本的な共同作業フロー</h3>
        <p>
          日常的な開発作業の標準的な流れです。
        </p>
        <div class="command-block">
          <pre><code># 1. 最新のmainを取得
git checkout main
git pull origin main

# 2. 新しいブランチを作成
git checkout -b feature/new-feature

# 3. 作業してコミット
git add .
git commit -m "Add new feature"

# 4. リモートにpush
git push -u origin feature/new-feature

# 5. プルリクエスト（PR）を作成
# GitHub/GitLab等のWebインターフェースで作成

# 6. レビュー後、mainにマージ
# レビュアーがマージするか、自分でマージ

# 7. ローカルのmainを更新
git checkout main
git pull origin main

# 8. 不要なブランチを削除
git branch -d feature/new-feature
git push origin --delete feature/new-feature</code></pre>
        </div>

        <h3>フォークベースのワークフロー</h3>
        <p>
          オープンソースプロジェクトなどで一般的なワークフローです。
        </p>
        <div class="command-block">
          <h4>初回セットアップ</h4>
          <pre><code># 1. GitHubでリポジトリをフォーク
# Webインターフェースで「Fork」ボタンをクリック

# 2. フォークをクローン
git clone https://github.com/your-username/repository.git
cd repository

# 3. 元のリポジトリをupstreamとして追加
git remote add upstream https://github.com/original/repository.git

# 4. リモートを確認
git remote -v
# origin    https://github.com/your-username/repository.git (fetch)
# origin    https://github.com/your-username/repository.git (push)
# upstream  https://github.com/original/repository.git (fetch)
# upstream  https://github.com/original/repository.git (push)</code></pre>

          <h4>日常的な作業</h4>
          <pre><code># 1. upstreamの最新を取得
git fetch upstream
git checkout main
git merge upstream/main

# 2. 新しいブランチで作業
git checkout -b feature/contribution
# ... 作業 ...
git commit -m "Add contribution"

# 3. 自分のフォークにpush
git push origin feature/contribution

# 4. GitHubでPRを作成
# 元のリポジトリに対してプルリクエストを作成

# 5. レビュー対応で修正が必要な場合
git add .
git commit -m "Address review comments"
git push origin feature/contribution
# PRは自動的に更新される

# 6. マージ後、ローカルを更新
git checkout main
git fetch upstream
git merge upstream/main
git push origin main</code></pre>
        </div>

        <h3>Git Flow</h3>
        <p>
          体系的なブランチ管理モデルです。大規模プロジェクトで有用です。
        </p>
        <div class="command-block">
          <h4>ブランチの種類</h4>
          <pre><code># メインブランチ（永続的）
# main (master)  : 本番環境のコード
# develop        : 開発中のコード

# サポートブランチ（一時的）
# feature/*      : 新機能開発
# release/*      : リリース準備
# hotfix/*       : 緊急修正</code></pre>

          <h4>機能開発フロー</h4>
          <pre><code># 1. developから機能ブランチを作成
git checkout develop
git pull origin develop
git checkout -b feature/user-profile

# 2. 開発作業
git add .
git commit -m "Implement user profile"
git push origin feature/user-profile

# 3. developにマージ
git checkout develop
git merge --no-ff feature/user-profile
git push origin develop

# 4. ブランチ削除
git branch -d feature/user-profile
git push origin --delete feature/user-profile</code></pre>

          <h4>リリースフロー</h4>
          <pre><code># 1. developからリリースブランチを作成
git checkout develop
git checkout -b release/1.0.0

# 2. バージョン番号の更新など
# ... 微調整 ...
git commit -m "Bump version to 1.0.0"

# 3. mainにマージ
git checkout main
git merge --no-ff release/1.0.0
git tag -a v1.0.0 -m "Release version 1.0.0"
git push origin main --tags

# 4. developにもマージ（変更を反映）
git checkout develop
git merge --no-ff release/1.0.0
git push origin develop

# 5. リリースブランチ削除
git branch -d release/1.0.0
git push origin --delete release/1.0.0</code></pre>

          <h4>ホットフィックスフロー</h4>
          <pre><code># 1. mainからホットフィックスブランチを作成
git checkout main
git checkout -b hotfix/critical-bug

# 2. 修正作業
git commit -m "Fix critical bug"

# 3. mainにマージ
git checkout main
git merge --no-ff hotfix/critical-bug
git tag -a v1.0.1 -m "Hotfix version 1.0.1"
git push origin main --tags

# 4. developにもマージ
git checkout develop
git merge --no-ff hotfix/critical-bug
git push origin develop

# 5. ホットフィックスブランチ削除
git branch -d hotfix/critical-bug</code></pre>
        </div>

        <h3>GitHub Flow</h3>
        <p>
          シンプルで軽量なワークフローです。継続的デプロイに適しています。
        </p>
        <div class="command-block">
          <pre><code># 原則
# - mainブランチは常にデプロイ可能
# - 新しい作業は必ずmainからブランチを作成
# - PRを通じてmainにマージ
# - マージ後すぐにデプロイ

# ワークフロー
# 1. mainから作業ブランチを作成
git checkout main
git pull origin main
git checkout -b feature-branch

# 2. コミットしてpush
git add .
git commit -m "Add feature"
git push origin feature-branch

# 3. PRを作成してレビュー

# 4. CIが通ったらmainにマージ

# 5. 自動的にデプロイ

# 6. ブランチ削除
git branch -d feature-branch
git push origin --delete feature-branch</code></pre>
        </div>
      </section>
    </article>

    <Navigation currentPage="remote" />

    <footer class="page-footer">
      <p><a href="/tools/git-cheatsheet">目次に戻る</a> | <a href="/">トップページに戻る</a></p>
    </footer>
  </main>
</Layout>

<style>
  main {
    max-width: 900px;
    margin: 0 auto;
    padding: 2rem 1rem;
    line-height: 1.7;
  }

  .page-header {
    text-align: center;
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 2px solid #667eea;
  }

  h1 {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .subtitle {
    font-size: 1.1rem;
    color: #666;
  }

  article section {
    margin-bottom: 3rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid #eee;
  }

  article section:last-of-type {
    border-bottom: none;
  }

  h2 {
    font-size: 1.8rem;
    margin-bottom: 1rem;
    color: #333;
    padding-top: 1rem;
  }

  h3 {
    font-size: 1.4rem;
    margin-top: 2rem;
    margin-bottom: 1rem;
    color: #444;
    border-bottom: 2px solid #f0f0f0;
    padding-bottom: 0.5rem;
  }

  h4 {
    font-size: 1.1rem;
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
    color: #555;
  }

  p {
    margin-bottom: 1rem;
    color: #444;
  }

  .command-block {
    background: #f8f9fa;
    border-left: 4px solid #667eea;
    padding: 1.5rem;
    margin: 1.5rem 0;
    border-radius: 4px;
  }

  .command-block h4 {
    margin-top: 0;
    margin-bottom: 1rem;
    color: #667eea;
  }

  pre {
    background: #2d2d2d;
    color: #f8f8f2;
    padding: 1rem;
    border-radius: 4px;
    overflow-x: auto;
    margin: 1rem 0;
  }

  code {
    font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
    font-size: 0.9rem;
    line-height: 1.5;
  }

  .page-footer {
    text-align: center;
    margin-top: 3rem;
    padding-top: 2rem;
    border-top: 2px solid #667eea;
    color: #666;
  }

  .page-footer a {
    color: #667eea;
    text-decoration: none;
  }

  .page-footer a:hover {
    text-decoration: underline;
  }
</style>
