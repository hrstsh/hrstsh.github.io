---
import Layout from '../../layouts/Layout.astro';
import CodeBlock from '../../components/CodeBlock.astro';

const shellScript = `#!/bin/zsh

python3 $(cd $(dirname $0); pwd)/amv.py`;

const pythonScript = `import glob
import os

def getPattern():
\treturn input("[入力]変更するファイル群を指定するパターン： ")

def getFiles(pattern):
\tfiles = [p for p in glob.glob(pattern) if os.path.isfile(p)]
\tfiles.sort()
\tif files:
\t\tprint("変更対象のファイル：")
\t\tfor file in files:
\t\t\tprint("- " + file)
\t\tprint("上記のファイル群を {固定文字列}_{連番}.{拡張子} の形式で一括変換します")
\t\tprint()
\telse:
\t\tprint("パターンに合致するファイルがありません")
\t\tprint("ワイルドカード(*)のみ使用できます")
\t\texit()
\treturn files

def getFixed():
\treturn input("[入力]ファイル名の固定文字列：")

def renameFiles(files, fixed):
\tprint()
\tfor i in range(len(files)):
\t\textension = files[i].split(".")[-1]
\t\tafter = f"{fixed}_{i+1:03}.{extension}"
\t\tos.rename(files[i], after)
\t\tprint(f"{files[i]}  ->  {after}")

def main():
\tpattern = getPattern()
\tfiles = getFiles(pattern)
\tfixed = getFixed()
\trenameFiles(files, fixed)

if __name__ == "__main__":
\tmain()`;

const zshrcConfig = `# 自作コマンドのPATH設定
export PATH=$HOME/MyCommands/amv:$PATH`;

const usageExample = `$ cd ~/Downloads
$ ls
photo1.jpg  photo2.jpg  photo3.jpg  IMG_001.jpg  IMG_002.jpg

$ amv
[入力]変更するファイル群を指定するパターン： *.jpg
変更対象のファイル：
- IMG_001.jpg
- IMG_002.jpg
- photo1.jpg
- photo2.jpg
- photo3.jpg
上記のファイル群を {固定文字列}_{連番}.{拡張子} の形式で一括変換します

[入力]ファイル名の固定文字列：vacation

IMG_001.jpg  ->  vacation_001.jpg
IMG_002.jpg  ->  vacation_002.jpg
photo1.jpg  ->  vacation_003.jpg
photo2.jpg  ->  vacation_004.jpg
photo3.jpg  ->  vacation_005.jpg`;

const directoryStructure = `~/MyCommands/
  └── amv/
      ├── amv        # シェルスクリプト（エントリーポイント）
      └── amv.py     # Python本体`;

const chmodCommand = `chmod +x ~/MyCommands/amv/amv`;
---

<Layout title="Macで自作コマンドを作って登録する方法 - hrの備忘録" description="Mac のターミナルで自作コマンドを作成・登録する方法。ファイル名一括変換コマンドを例に、シェルスクリプト、Python、PATH 設定を解説。">
  <main>
    <header class="article-header">
      <a href="/tips" class="back-link">← 小技集一覧</a>
      <h1>Macで自作コマンドを作って登録する方法</h1>
    </header>

    <article class="article-body">
      <p>
        Macのターミナルで繰り返し行う作業ってありますよね。
        そんな時、自分専用のコマンドを作って登録しておくと作業効率が格段に上がる。
      </p>
      <p>
        今回は<strong>ファイル名を一括変換するコマンド</strong>を例に、
        自作コマンドの作り方から PATH 設定までを解説します。
      </p>

      <h2>自作コマンドを作るメリット</h2>
      <ul>
        <li><strong>作業効率の向上</strong>: 長いコマンドを短縮できる</li>
        <li><strong>ミス防止</strong>: よく使う処理を定型化できる</li>
        <li><strong>カスタマイズ性</strong>: 自分の使い方に最適化できる</li>
        <li><strong>再利用性</strong>: 一度作れば他のマシンでも使える</li>
      </ul>

      <h2>今回作るコマンド：ファイル名一括変換</h2>
      <p>
        ここでは<strong>「amv」（all mv の意）</strong>というコマンド名で、
        複数のファイル名を一括で「<strong>固定文字列_連番.拡張子</strong>」の形式に変換するコマンドを作ってみます。
      </p>
      <p>
        例えば、バラバラの名前の画像ファイルを <code>vacation_001.jpg</code>、<code>vacation_002.jpg</code>... と整理できる。
      </p>

      <h2>自作コマンドの作り方（基本の流れ）</h2>
      
      <h3>1. コマンド用のディレクトリを作成</h3>
      <p>まず、自作コマンドを保存するディレクトリを作る。</p>
      <CodeBlock code={directoryStructure} language="plaintext" />
      <p>
        <code>~/MyCommands/</code> 以下に、コマンドごとにディレクトリを作る構成。
        コマンド名は好きな名前でOK。
      </p>

      <h3>2. シェルスクリプト（エントリーポイント）を作成</h3>
      <p>
        <code>~/MyCommands/amv/amv</code> ファイルを作成（拡張子なし）。
      </p>
      <CodeBlock code={shellScript} language="bash" />
      <p>
        このスクリプトは Python ファイルを呼び出す役割。
        <code>$(cd $(dirname $0); pwd)</code> で、スクリプト自身のディレクトリを取得してる。
      </p>

      <h3>3. Python 本体を作成</h3>
      <p>
        <code>~/MyCommands/amv/amv.py</code> に実際の処理を書く。
      </p>
      <CodeBlock code={pythonScript} language="python" />
      <p>
        この Python スクリプトは以下の流れで動作：
      </p>
      <ul>
        <li>ワイルドカードでファイルを選択</li>
        <li>固定文字列を入力</li>
        <li>連番付きでリネーム</li>
      </ul>

      <h3>4. 実行権限を付与</h3>
      <p>シェルスクリプトに実行権限を与える。</p>
      <CodeBlock code={chmodCommand} language="bash" />

      <h2>PATH 設定で、どこからでも実行可能に</h2>
      <p>
        作成したコマンドをどこからでも実行できるように、<code>~/.zshrc</code> に PATH を追加する。
      </p>
      
      <h3>~/.zshrc に追記</h3>
      <CodeBlock code={zshrcConfig} language="bash" />
      
      <p>設定を反映させるため、ターミナルを再起動するか以下を実行。</p>
      <CodeBlock code="source ~/.zshrc" language="bash" />
      
      <p>
        これで <code>amv</code> コマンドがどのディレクトリからでも実行できるようになる。
      </p>

      <h2>使い方</h2>
      <p>実際に使ってみる。</p>
      <CodeBlock code={usageExample} language="plaintext" />
      <p>
        ワイルドカード（<code>*.jpg</code>）で対象ファイルを指定して、
        固定文字列を入力すると自動的に連番付きでリネームされる。
      </p>

      <h2>応用：他のコマンドを作る</h2>
      <p>
        この構成を応用すれば、さまざまな自作コマンドを作れる。
      </p>
      <ul>
        <li><strong>よく使うコマンドのメモ表示</strong>（単純な cat コマンド）</li>
        <li><strong>定型作業の自動化</strong>（ファイル移動、バックアップなど）</li>
        <li><strong>API 連携</strong>（外部サービスへの投稿など）</li>
      </ul>
      <p>
        Python 以外にも、シェルスクリプトだけ、Ruby、Node.js など好きな言語で作成できる。
      </p>

      <h2>まとめ</h2>
      <p>
        自作コマンドを作ることで日々の作業が効率化されて、ターミナル操作がより快適になる。
      </p>
      <p>
        一度覚えてしまえばいろいろな場面で応用できるので、ぜひ試してみてください。
      </p>
    </article>
  </main>
</Layout>

<style>
  main {
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem 1rem;
    line-height: 1.7;
  }

  .article-header {
    margin-bottom: 2rem;
  }

  .back-link {
    display: inline-block;
    margin-bottom: 1rem;
    font-size: 0.9rem;
    color: #667eea;
    text-decoration: none;
  }

  .back-link:hover {
    text-decoration: underline;
  }

  h1 {
    font-size: 2rem;
    margin-bottom: 0.5rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .article-body h2 {
    font-size: 1.5rem;
    margin-top: 2rem;
    margin-bottom: 0.75rem;
    color: #333;
    border-bottom: 1px solid #e0e0e0;
    padding-bottom: 0.25rem;
  }

  .article-body h3 {
    font-size: 1.2rem;
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
    color: #444;
  }

  .article-body p, .article-body ul, .article-body ol {
    margin-bottom: 1rem;
    color: #444;
  }

  .article-body li {
    margin-bottom: 0.25rem;
  }

  .article-body code {
    background: rgba(30, 64, 175, 0.06);
    color: var(--color-code);
    padding: 0.15rem 0.4rem;
    border-radius: 4px;
    font-size: 0.9em;
  }

  pre {
    background: #2d2d2d;
    color: #f8f8f2;
    padding: 1rem 1.25rem;
    border-radius: 8px;
    overflow-x: auto;
    margin: 1rem 0;
    font-size: 0.9rem;
    line-height: 1.5;
  }

  pre code {
    background: none;
    color: inherit;
    padding: 0;
  }

  .page-footer {
    margin-top: 2.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid #e0e0e0;
    font-size: 0.95rem;
  }

  .page-footer a {
    color: #667eea;
    text-decoration: none;
  }

  .page-footer a:hover {
    text-decoration: underline;
  }

  .page-footer a + a {
    margin-left: 0.5rem;
  }
</style>
